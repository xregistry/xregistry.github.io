<html>
<head>
<style>
  .anchor {
    font-size: 12px ;
    vertical-align: middle ;
    text-decoration: none ;
  }
  body {
    font-family: sans-serif ;
    font-size: 16px ;
    line-height: 1.5 ;
    padding: 5% 10% 5% 10% ;
  }
  pre {
    font-size: 80% ;
    background-color: #f2f2f2 ;
    padding: 12px ;
  }
  code {
    font-size: 85% ;
    background-color: #f2f2f2 ;
    padding: .2em .4em ;
  }
  pre code {
    font-size: inherit ;
    background-color: inherit ;
    padding: 0px ;
  }
  table {
    border: 1px solid lightgray ;
    border-collapse: collapse ;
    border-spacing: 0px ;
    line-height: 24px ;
  }
  tr:nth-child(even) {
    background-color: #f2f2f2 ;
  }
  td,th {
    border: 1px solid lightgray ;
    padding: 5px ;
  }
  td code, th code {
    font-size: inherit ;
  }
</style>
</head>
<h1 id="endpoint-registry-service---version-10-rc2">Endpoint Registry Service - Version 1.0-rc2 <a class="anchor" href="#endpoint-registry-service---version-10-rc2">ðŸ”—</a></h1>
<h2 id="abstract">Abstract <a class="anchor" href="#abstract">ðŸ”—</a></h2>
<p>This specification defines an endpoint registry extension to the xRegistry
document format and API <a href="../core/spec.md">specification</a>.</p>
<h2 id="table-of-contents">Table of Contents <a class="anchor" href="#table-of-contents">ðŸ”—</a></h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#notations-and-terminology">Notations and Terminology</a>
<ul>
<li><a href="#notational-conventions">Notational Conventions</a></li>
<li><a href="#terminology">Terminology</a></li>
</ul>
</li>
<li><a href="#endpoint-registry-model">Endpoint Registry</a>
<ul>
<li><a href="#endpoints-groups">Endpoints</a></li>
</ul>
</li>
</ul>
<h2 id="overview">Overview <a class="anchor" href="#overview">ðŸ”—</a></h2>
<p>This specification defines a registry of metadata definitions for abstract and
concrete network endpoints to which messages can be produced, from which
messages can be consumed, or which make messages available for subscriptions.</p>
<p>For easy reference, the JSON serialization of an Endpoint Registry adheres to
this form:</p>
<pre><code class="language-yaml">{
  &quot;specversion&quot;: &quot;&lt;STRING&gt;&quot;,
  &quot;registryid&quot;: &quot;&lt;STRING&gt;&quot;,
  &quot;self&quot;: &quot;&lt;URL&gt;&quot;,
  &quot;xid&quot;: &quot;&lt;XID&gt;&quot;,
  &quot;epoch&quot;: &lt;UINTEGER&gt;,
  &quot;name&quot;: &quot;&lt;STRING&gt;&quot;, ?
  &quot;description&quot;: &quot;&lt;STRING&gt;&quot;, ?
  &quot;documentation&quot;: &quot;&lt;URL&gt;&quot;, ?
  &quot;labels&quot;: {
    &quot;&lt;STRING&gt;&quot;: &quot;&lt;STRING&gt;&quot; *
  }, ?
  &quot;createdat&quot;: &quot;&lt;TIMESTAMP&gt;&quot;,
  &quot;modifiedat&quot;: &quot;&lt;TIMESTAMP&gt;&quot;,

  &quot;model&quot;: { ... }, ?

  &quot;endpointsurl&quot;: &quot;&lt;URL&gt;&quot;,
  &quot;endpointscount&quot;: &lt;UINTEGER&gt;,
  &quot;endpoints&quot;: {
    &quot;&lt;KEY&gt;&quot;: {
      &quot;endpointid&quot;: &quot;&lt;STRING&gt;&quot;,                   # xRegistry core attributes
      &quot;self&quot;: &quot;&lt;URL&gt;&quot;,
      &quot;xid&quot;: &quot;&lt;XID&gt;&quot;,
      &quot;epoch&quot;: &lt;UINTEGER&gt;,
      &quot;name&quot;: &quot;&lt;STRING&gt;&quot;, ?
      &quot;description&quot;: &quot;&lt;STRING&gt;&quot;, ?
      &quot;documentation&quot;: &quot;&lt;URL&gt;&quot;, ?
      &quot;labels&quot;: { &quot;&lt;STRING&gt;&quot;: &quot;&lt;STRING&gt;&quot; * }, ?
      &quot;createdat&quot;: &quot;&lt;TIMESTAMP&gt;&quot;,
      &quot;modifiedat&quot;: &quot;&lt;TIMESTAMP&gt;&quot;,
      &quot;deprecated&quot;: { ... }, ?

      &quot;usage&quot;: [ &quot;&lt;STRING&gt;&quot; + ] ,                 # subscriber, consumer, producer
      &quot;channel&quot;: &quot;&lt;STRING&gt;&quot;, ?

      # Start of Endpoint extension attributes
      &quot;envelope&quot;: &quot;&lt;STRING&gt;&quot;, ?                   # e.g. CloudEvents/1.0
      &quot;envelopeoptions&quot;: {
        &quot;&lt;STRING&gt;&quot;: &lt;JSON-VALUE&gt; *

        # CloudEvents/1.0 options
        &quot;mode&quot;: &quot;&lt;STRING&gt;&quot;, ?                     # binary, structured
        &quot;format&quot;: &quot;&lt;STRING&gt;&quot; ?                    # e.g. application/json
      },

      &quot;protocol&quot;: &quot;&lt;STRING&gt;&quot;, ?                   # e.g. HTTP/1.1
      &quot;protocoloptions&quot;: {
        &quot;&lt;STRING&gt;&quot;: &lt;JSON-VALUE&gt; *

        # Common protocol options
        &quot;endpoints&quot;: [
          {
            &quot;url&quot;: &quot;&lt;URL&gt;&quot;                        # plus endpoint extensions
          } *
        ], ?
        &quot;authorization&quot;: {
          &quot;type&quot;: &quot;&lt;STRING&gt;&quot;, ?
          &quot;resourceuri&quot;: &quot;URI&quot;, ?
          &quot;authorityuri&quot;: &quot;URI&quot;, ?
          &quot;grant_types&quot;: [ &quot;&lt;STRING&gt;&quot; * ] ?
        }, ?
        &quot;deployed&quot;: &lt;BOOLEAN&gt;, ?

        # &quot;HTTP&quot; protocol options
        &quot;method&quot;: &quot;&lt;STRING&gt;&quot;, ?                          # Default: POST
        &quot;headers&quot;: [ { &quot;name&quot;: &quot;&lt;STRING&gt;&quot;, &quot;value&quot;: &quot;&lt;STRING&gt;&quot; } * ], ?
        &quot;query&quot;: { &quot;&lt;STRING&gt;&quot;: &quot;&lt;STRING&gt;&quot; * } ?

        # &quot;AMQP/1.0&quot; protocol options
        &quot;node&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;durable&quot;: &lt;BOOLEAN&gt;, ?                          # Default: false
        &quot;linkproperties&quot;: { &quot;&lt;STRING&gt;&quot;: &quot;&lt;STRING&gt;&quot; * }, ?
        &quot;connectionproperties&quot;: { &quot;&lt;STRING&gt;&quot;: &quot;&lt;STRING&gt;&quot; * }, ?
        &quot;distributionmode&quot;: &quot;move&quot; | &quot;copy&quot; ?          # Default: move

        # &quot;MQTT/3.1.1&quot; protocol options
        &quot;topic&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;qos&quot;: &lt;UINTEGER&gt;, ?                             # Default: 0
        &quot;retain&quot;: &lt;BOOLEAN&gt;, ?                           # Default: false
        &quot;cleansession&quot;: &lt;BOOLEAN&gt;, ?                     # Default: true
        &quot;willtopic&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;willmessage&quot;: &quot;&lt;XID&gt;&quot; ?

        # &quot;MQTT/5.0&quot; protocol options
        &quot;topic&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;qos&quot;: &lt;UINTEGER&gt;, ?                             # Default: 0
        &quot;retain&quot;: &lt;BOOLEAN&gt;, ?                           # Default: false
        &quot;cleansession&quot;: &lt;BOOLEAN&gt;, ?                     # Default: true
        &quot;willtopic&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;willmessage&quot;: &quot;&lt;XID&gt;&quot; ?

        # &quot;KAFKA&quot; protocol options
        &quot;topic&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;acks&quot;: &lt;INTEGER&gt;, ?                             # Default: 1
        &quot;key&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;partition&quot;: &lt;INTEGER&gt;, ?
        &quot;consumergroup&quot;: &quot;&lt;STRING&gt;&quot;, ?
        &quot;headers&quot;: { &quot;&lt;STRING&gt;&quot;: &quot;&lt;STRING&gt;&quot; * } ?

        # &quot;NATS&quot; protocol options
        &quot;subject&quot;: &quot;&lt;STRING&gt;&quot; ?
      }, ?

      &quot;messagegroups&quot;: [ XID * ], ?
      # End of Endpoint extensions

      &quot;messagesurl&quot;: &quot;&lt;URL&gt;&quot;, ?
      &quot;messagescount&quot;: &lt;UINTEGER&gt;, ?
      &quot;messages&quot;: {
        &quot;&lt;KEY&gt;&quot;: {                                # messageid
          # See Message Definition spec for details
        } *
      } ?
    } *
  } ?
}
</code></pre>
<h2 id="notations-and-terminology">Notations and Terminology <a class="anchor" href="#notations-and-terminology">ðŸ”—</a></h2>
<h3 id="notational-conventions">Notational Conventions <a class="anchor" href="#notational-conventions">ðŸ”—</a></h3>
<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;,
&quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be
interpreted as described in <a href="https://tools.ietf.org/html/rfc2119">RFC 2119</a>.</p>
<p>For clarity, OPTIONAL attributes (specification-defined and extensions) are
OPTIONAL for clients to use, but the servers' responsibility will vary.
Server-unknown extension attributes MUST be silently stored in the backing
datastore. Specification-defined, and server-known extension, attributes MUST
generate an error if corresponding feature is not supported or enabled.
However, as with all attributes, if accepting the attribute would result in a
bad state (such as exceeding a size limit, or results in a security issue),
then the server MAY choose to reject the request.</p>
<p>In the pseudo JSON format snippets <code>?</code> means the preceding attribute is
OPTIONAL, <code>*</code> means the preceding attribute MAY appear zero or more times,
and <code>+</code> means the preceding attribute MUST appear at least once. The presence
of the <code>#</code> character means the remaining portion of the line is a comment.
Whitespace characters in the JSON snippets are used for readability and are
not normative.</p>
<h3 id="terminology">Terminology <a class="anchor" href="#terminology">ðŸ”—</a></h3>
<p>This specification defines the following terms:</p>
<h3 id="endpoint">Endpoint <a class="anchor" href="#endpoint">ðŸ”—</a></h3>
<p>An &quot;endpoint&quot; is a logical or physical network location to which messages can
be produced, from which messages can be consumed, or which makes messages
available via subscription for delivery to a consumer-designated endpoint.</p>
<h2 id="endpoint-registry-model">Endpoint Registry Model <a class="anchor" href="#endpoint-registry-model">ðŸ”—</a></h2>
<p>The Endpoint Registry is a registry of metadata definitions for abstract and
concrete network endpoints to which messages can be produced, from which
messages can be consumed, or which makes messages available via subscription
and delivery to a consumer-designated endpoint.</p>
<p>As discussed in the <a href="../cloudevents/spec.md">CloudEvents Registry overview</a>,
endpoints are supersets of
<a href="../message/spec.md#message-definition-groups">message definition groups</a> and
MAY contain inlined messages. Therefore, the Resources in the meta-model for
the Endpoint Registry are likewise <code>messages</code> as defined in the
<a href="../message/spec.md">message catalog specification</a>.</p>
<p>The formal xRegistry extension model of the Endpoints Registry
resides in the <a href="model.json">model.json</a> file.</p>
<h3 id="endpoints-groups">Endpoints Groups <a class="anchor" href="#endpoints-groups">ðŸ”—</a></h3>
<p>The Group plural name (<code>&lt;GROUPS&gt;</code>) is <code>endpoints</code>, and the Group singular
name (<code>&lt;GROUP&gt;</code>) is <code>endpoint</code>.</p>
<p>The following attributes are defined for the <code>endpoint</code> object in addition
to the xRegistry-defined core
<a href="../core/spec.md#attributes-and-extensions">attributes</a>:</p>
<h4 id="usage"><code>usage</code> <a class="anchor" href="#usage">ðŸ”—</a></h4>
<ul>
<li>
<p>Type: Array of String (Enum: <code>subscriber</code>, <code>consumer</code>, <code>producer</code>)</p>
</li>
<li>
<p>Description: The <code>usage</code> attribute is a set of strings that indicates the
intended usage of the endpoint by communicating parties. In other words, the
roles a client can act in when talking with the endpoint.</p>
<p>Each of these parties will have a different perspective on an endpoint. For
instance, a <code>producer</code> endpoint is seen as a &quot;target&quot; by the originator of
messages, and as a &quot;source&quot; by the party that accepts the messages. The
nomenclature used for the <code>usage</code> field is primarily oriented around the
common scenario of network endpoints being provided by some sort of
intermediary like a message broker. The term <code>producer</code> primarily describes
the relationship of a client with that intermediary.</p>
<p>In a direct-delivery scenario where the originator of messages connects
directly to the target (e.g. a &quot;WebHook&quot; call), the target endpoint
implements the accepting end of the <code>producer</code> relationship.</p>
<p>Some of these perspectives are mentioned below for illustration, but not
formally defined or reflected in the metadata model. Perspectives depend on
the context in which the endpoint metadata is used and this metadata model is
intentionally leaving perspectives open to users.</p>
<p>The following values are defined for <code>usage</code></p>
<ul>
<li>
<p><code>subscriber</code>: The endpoint offers managing subscriptions for delivery of
messages to another endpoint, using the <a href="https://github.com/cloudevents/spec/blob/main/subscriptions/spec.md">CloudEvents Subscriptions
API</a>.</p>
<p>Some perspectives that might exist on a subscriber endpoint:</p>
<ul>
<li>Application from which messages originate.</li>
<li>Application which accepts messages from the delivery agent.</li>
<li>Application which manages subscriptions for delivery of messages to the
target application. This might be a message broker subscription manager.</li>
</ul>
</li>
<li>
<p><code>consumer</code>: The endpoint offers messages being consumed (pulled) from it.</p>
<p>Some perspectives that might exist on a consumer endpoint:</p>
<ul>
<li>Message store or source which makes messages available for consumption;
this might be a message broker topic or a queue.</li>
<li>Proxy or other intermediary which solicits messages from the source and
forwards them to the target endpoint.</li>
<li>Application which consumes messages.</li>
</ul>
</li>
<li>
<p><code>producer</code>: The endpoint offers messages being produced (pushed) to it.</p>
<p>Some perspectives might exist on a producer endpoint:</p>
<ul>
<li>Application from which messages originate.</li>
<li>Reverse proxy or other intermediary which accepts messages from the
originator and forwards them to the target endpoint.</li>
<li>Application which accepts messages. This might be a message broker topic
or a queue. This might be an HTTP endpoint that directly accepts and
handles messages.</li>
</ul>
</li>
</ul>
<p>Any endpoint can be seen from different role perspectives:</p>
<p>There might also be further perspectives such as pipeline stages for
pre-/post-processing, etc.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>REQUIRED.</li>
<li>MUST contain only the following possible values:
<ul>
<li>&quot;subscriber&quot;</li>
<li>&quot;consumer&quot;</li>
<li>&quot;producer&quot;</li>
</ul>
</li>
<li>MUST be an array of at least one.</li>
</ul>
</li>
</ul>
<h4 id="channel"><code>channel</code> <a class="anchor" href="#channel">ðŸ”—</a></h4>
<ul>
<li>
<p>Type: String</p>
</li>
<li>
<p>Description: A string that can be used to correlate Endpoints. Any Endpoints
within an instance of an Endpoint Registry that share the same non-empty
<code>channel</code> value MUST have some relationship. This specification does not
define that relationship or the specific values used in this property.
However, it is expected that the <code>usage</code> value in combination with this
<code>channel</code> property will provide some information to help determine the
relationship.</p>
<p>For instance, a message broker queue &quot;queue1&quot; might be represented with a
<code>producer</code> endpoint and a <code>consumer</code> endpoint, both with the same <code>channel</code>
attribute value of &quot;queue1&quot;.</p>
<p>An event processing pipeline might have a sequence of stages, each with a
<code>producer</code> endpoint and a <code>consumer</code> endpoint, all with the same <code>channel</code>
attribute value of &quot;pipeline1&quot;, or some further qualification like
&quot;pipeline1-stage1&quot;, etc.</p>
<p>This specification does not make any statement about whether two endpoints
that do not share the same non-empty value have any relationship or not.
They might, but how this is determined is out of scope of this specification.
Additionally, while it is expected that this attribute's value will be a
single value, given this specification does not place any constraints on
its syntax or semantic meaning, implementations might choose to &quot;encode&quot;
multiple values within this single string. That would then imply that the
comparison algorithm of two <code>channel</code> values might need to be more
complicated than a &quot;string compare&quot; in those cases.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
<li>When specified, the value MUST be a non-empty string.</li>
</ul>
</li>
<li>
<p>Examples:</p>
<ul>
<li><code>queue1</code></li>
</ul>
</li>
</ul>
<h4 id="envelope"><code>envelope</code> <a class="anchor" href="#envelope">ðŸ”—</a></h4>
<ul>
<li>Type: String</li>
<li>Description: The name of the specification that defines the Resource
stored in the registry. Often it is difficult to unambiguously determine
what a Resource is by simply inspecting its serialized form. This attribute
provides a mechanism by which it can be determined without examination of
the Resource at all.</li>
<li>Constraints:
<ul>
<li>MUST be a non-empty case-insensitive string of the form
<code>&lt;SPEC&gt;[/&lt;VERSION&gt;]</code>,
where <code>&lt;SPEC&gt;</code> is the non-empty string name of the specification that
defines the Resource. An OPTIONAL <code>&lt;VERSION&gt;</code> value SHOULD be included if
there are multiple versions of the specification available.</li>
<li>If a <code>&lt;VERSION&gt;</code> is specified at the Group level, all Resources within that
Group MUST have a <code>&lt;VERSION&gt;</code> value that is at least as precise as its
Group, and MUST NOT expand it. For example, if a Group had a
<code>envelope</code> value of <code>myspec</code>, then Resources within that Group can have
<code>envelope</code> values of <code>myspec</code> or <code>myspec/1.0</code>. However, if a Group has a
value of <code>myspec/1.0</code>, it would be invalid for a Resource to have a value
of <code>myspec/2.0</code> or just <code>myspec</code>. Additionally, if a Group does not have
a <code>envelope</code> attribute then there are no constraints on its Resources
<code>envelope</code> attributes.</li>
<li>This specification places no restriction on the syntax of the
<code>&lt;VERSION&gt;</code> value.</li>
</ul>
</li>
<li>Examples:
<ul>
<li><code>CloudEvents/1.0</code></li>
</ul>
</li>
</ul>
<h4 id="envelopeoptions"><code>envelopeoptions</code> <a class="anchor" href="#envelopeoptions">ðŸ”—</a></h4>
<ul>
<li>
<p>Type: Map</p>
</li>
<li>
<p>Description: Configuration details of the endpoint with respect to the
envelope format used to transmit the messages.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
</ul>
</li>
<li>
<p>Examples:</p>
<ul>
<li>For an endpoint using an <code>envelope</code> value of <code>CloudEvents/1.0</code>:
<code>{ &quot;mode&quot;: &quot;binary&quot;, &quot;format&quot;: &quot;application/json&quot; }</code></li>
</ul>
</li>
</ul>
<p>This specification defines the following envelope options for the indicated
<code>envelope</code> values:</p>
<h5 id="cloudevents10"><code>CloudEvents/1.0</code> <a class="anchor" href="#cloudevents10">ðŸ”—</a></h5>
<ul>
<li><code>mode</code> : indicates whether the CloudEvent will use <code>binary</code> or <code>structured</code>
(mode)[https://github.com/cloudevents/spec/blob/main/cloudevents/spec.md#message].
When specified, its value MUST be one of: <code>binary</code> or <code>structured</code>, case
sensitive. When not specified, the endpoint is indicating that either mode
is acceptable.</li>
<li><code>format</code> : indicates the format of the CloudEvent when sent in <code>structured</code>
mode. This attribute MUST NOT be specified when <code>mode</code> is <code>binary</code>. The value
used MUST match the expected content type of the message (e.g. for HTTP the
<code>Content-Type</code> header value).</li>
</ul>
<h4 id="protocol"><code>protocol</code> <a class="anchor" href="#protocol">ðŸ”—</a></h4>
<ul>
<li>
<p>Type: String</p>
</li>
<li>
<p>Description: The transport or application protocol used by the endpoint. This
specification defines a set of common protocol names that MUST be used for
respective protocol endpoints, but implementations MAY define and use
additional protocol names.</p>
<p>An example for an extension protocol identifier might be &quot;BunnyMQ/0.9.1&quot;.</p>
<p>Predefined protocols SHOULD be referred to by name and version as
<code>&lt;NAME&gt;/&lt;VERSION&gt;</code>. The version number format is determined by the protocol
specification's usage of versions. If the version is not specified, the
default version of the protocol is assumed. For AMQP and MQTT, see the list
below. For others, refer to the protocol specifications.</p>
<p>The predefined protocol names are:</p>
<ul>
<li>&quot;HTTP&quot; - Used for HTTP/1.1, HTTP/2, HTTP/3.</li>
<li>&quot;AMQP/1.0&quot; - Use the <a href="https://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-overview-v1.0-os.html">AMQP 1.0</a> protocol. MAY be shortened to
&quot;AMQP&quot;. AMQP draft versions before 1.0 (e.g. 0.9) are <em>not</em> AMQP.</li>
<li>&quot;MQTT/3.1.1&quot;, &quot;MQTT/5.0&quot; - Use the MQTT <a href="https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html">3.1.1</a> or <a href="https://docs.oasis-open.org/mqtt/mqtt/v5.0/mqtt-v5.0.html">5.0</a> protocol. The shorthand &quot;MQTT&quot; maps to &quot;MQTT/5.0&quot;.</li>
<li>&quot;NATS&quot; - Use the <a href="https://docs.nats.io/reference/reference-protocols/nats-protocol">NATS</a> protocol.</li>
<li>&quot;KAFKA&quot; - Use the <a href="https://kafka.apache.org/protocol">Apache Kafka</a> protocol.</li>
</ul>
<p>All messages inside an Endpoint MUST use this same protocol.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>MUST be a non-empty case-insensitive string.</li>
<li>SHOULD follow the naming convention <code>&lt;NAME&gt;/&lt;VERSION&gt;</code>,
whereby <code>&lt;NAME&gt;</code> is the name of the protocol and <code>&lt;VERSION&gt;</code> is the
version of protocol.</li>
</ul>
</li>
<li>
<p>Examples:</p>
<ul>
<li><code>MQTT/3.1.1</code></li>
<li><code>AMQP/1.0</code></li>
<li><code>KAFKA</code></li>
</ul>
</li>
</ul>
<h4 id="protocoloptions"><code>protocoloptions</code> <a class="anchor" href="#protocoloptions">ðŸ”—</a></h4>
<ul>
<li>
<p>Type: Map</p>
</li>
<li>
<p>Description: Configuration details of the endpoint related to the protocol
used to transmit the messages. An endpoint MAY be defined without detail
configuration. In this case, the endpoint is considered to be &quot;abstract&quot;.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
</ul>
</li>
</ul>
<h5 id="protocoloptionsendpoints"><code>protocoloptions.endpoints</code> <a class="anchor" href="#protocoloptionsendpoints">ðŸ”—</a></h5>
<ul>
<li>Type: Array of Objects</li>
<li>Description: An array of objects map where each object contains a <code>uri</code>
attribute with the network address to which clients can communicate with
the endpoint. The object MAY contain extension attributes that can be used
by clients to determine which URI to use, or to configure access to the
specific URI. Whether the URI identifies a network host or links directly to
a resource managed by the network host is protocol specific.</li>
<li>Constraints:
<ul>
<li>OPTIONAL.</li>
<li>Each object MUST contain a <code>uri</code> attribute with a valid, absolute URI (URL).</li>
</ul>
</li>
<li>Examples:
<ul>
<li><code>[ {&quot;uri&quot;: &quot;https://example.com&quot; } ]</code></li>
<li>
<pre><code>[
  { &quot;uri&quot;: &quot;tcp://example.com&quot; },
  { &quot;uri&quot;: &quot;wss://example.com&quot; }
]
</code></pre>
</li>
<li>
<pre><code>[
  {
    &quot;uri&quot;: &quot;tcp://example.com&quot;,
    &quot;priority&quot;: 1,
    &quot;status&quot;: &quot;down&quot;
  },
  {
    &quot;uri&quot;: &quot;wss://example.com&quot;,
    &quot;priority&quot;: 2,
    &quot;status&quot;: &quot;up&quot;
  }
]
</code></pre>
</li>
</ul>
</li>
</ul>
<h5 id="protocoloptionsauthorization"><code>protocoloptions.authorization</code> <a class="anchor" href="#protocoloptionsauthorization">ðŸ”—</a></h5>
<ul>
<li>
<p>Type: Map</p>
</li>
<li>
<p>Description: OPTIONAL authorization configuration details of the endpoint.
When specified, the authorization configuration MUST be a map of non-empty
strings to non-empty strings. The configuration keys below MUST be used as
defined. Additional, endpoint-specific configuration keys MAY be added.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
<li>MUST only be used for authorization configuration.</li>
<li>MUST NOT be used for credential configuration.</li>
</ul>
</li>
</ul>
<h6 id="protocoloptionsauthorizationtype"><code>protocoloptions.authorization.type</code> <a class="anchor" href="#protocoloptionsauthorizationtype">ðŸ”—</a></h6>
<ul>
<li>
<p>Type: String</p>
</li>
<li>
<p>Description: The type of the authorization configuration. The value SHOULD be
one of the following:</p>
<ul>
<li>OAuth2: OAuth 2.0 authorization is used.</li>
<li>Plain: The client uses username with a plaintext password for
authentication and authorization.</li>
<li>X509Cert: The client uses client certificate authentication and
authorization.</li>
<li>APIKey: The client uses an API key for authentication and authorization.</li>
</ul>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
<li>MUST be a non-empty string if used.</li>
</ul>
</li>
</ul>
<h6 id="protocoloptionsauthorizationresourceuri"><code>protocoloptions.authorization.resourceuri</code> <a class="anchor" href="#protocoloptionsauthorizationresourceuri">ðŸ”—</a></h6>
<ul>
<li>
<p>Type: URI</p>
</li>
<li>
<p>Description: The URI of the resource for which the authorization is
requested. The format of the URI depends on the authorization type.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
<li>MUST be a non-empty URI if used.</li>
</ul>
</li>
</ul>
<h6 id="protocoloptionsauthorizationauthorityuri"><code>protocoloptions.authorization.authorityuri</code> <a class="anchor" href="#protocoloptionsauthorizationauthorityuri">ðŸ”—</a></h6>
<ul>
<li>
<p>Type: URI</p>
</li>
<li>
<p>Description: The URI of the authorization authority from which the
authorization is requested. The format of the URI depends on the
authorization type.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
<li>MUST be a non-empty URI if used.</li>
</ul>
</li>
</ul>
<h6 id="protocoloptionsauthorizationgrant_types"><code>protocoloptions.authorization.grant_types</code> <a class="anchor" href="#protocoloptionsauthorizationgrant_types">ðŸ”—</a></h6>
<ul>
<li>
<p>Type: Array of Strings</p>
</li>
<li>
<p>Description: The supported authorization grant types. The value SHOULD be a
list of strings.</p>
</li>
<li>
<p>Constraints:</p>
<ul>
<li>OPTIONAL.</li>
<li>MUST be a non-empty array if used.</li>
</ul>
</li>
</ul>
<h5 id="protocoloptionsdeployed"><code>protocoloptions.deployed</code> <a class="anchor" href="#protocoloptionsdeployed">ðŸ”—</a></h5>
<ul>
<li>Type: Boolean</li>
<li>Description: If <code>true</code>, the endpoint metadata represents a public, live
endpoint that is available for communication and a strict validator MAY test
the liveness of the endpoint.</li>
<li>Constraints:
<ul>
<li>OPTIONAL.</li>
<li>If present, MUST be either <code>true</code> or <code>false</code>, case-sensitive.</li>
<li>When not specified, the default value is MUST be <code>false</code>.</li>
</ul>
</li>
</ul>
<h5 id="protocoloptionsoptions"><code>protocoloptions.options</code> <a class="anchor" href="#protocoloptionsoptions">ðŸ”—</a></h5>
<ul>
<li>Type: Map</li>
<li>Description: Additional configuration options for the endpoint. The
configuration options are protocol specific and described in the
<a href="#protocol-options">protocol options</a> section below.</li>
<li>Constraints:
<ul>
<li>OPTIONAL.</li>
<li>When specified, MUST be a map of non-empty strings to <code>ANY</code> type values.</li>
<li>If <code>protocoloptions.protocol</code> is a well-known protocol, the options MUST be
compliant with the <a href="#protocol-options">protocol's options</a>.</li>
</ul>
</li>
</ul>
<h4 id="messagegroups"><code>messagegroups</code> <a class="anchor" href="#messagegroups">ðŸ”—</a></h4>
<p>The <code>messagegroups</code> attribute is an array of XID-references to message
definition groups. The <code>messagegroups</code> attribute is used to reference
message definition groups that are not inlined in the endpoint definition.</p>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;HTTP/1.1&quot;,
  &quot;protocoloptions&quot;: {
    &quot;method&quot;: &quot;POST&quot;
  },
  &quot;messagegroups&quot;: [
    &quot;/messagegroups/mygroup&quot;
  ]
}
</code></pre>
<h4 id="messages"><code>messages</code> <a class="anchor" href="#messages">ðŸ”—</a></h4>
<p>Endpoints are supersets of
<a href="../message/spec.md#message-definition-groups">message definition groups</a> and
MAY contain inlined messages. See
<a href="../message/spec.md#message-definitions">Message Definitions</a>.</p>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;HTTP/1.1&quot;,
  &quot;protocoloptions&quot;: {
    &quot;method&quot;: &quot;POST&quot;
  },

  &quot;messagesurl&quot;: &quot;...&quot;,
  &quot;messagescount&quot;: 1,
  &quot;messages&quot;: {
    &quot;myevent&quot;: {
      &quot;envelope&quot;: &quot;CloudEvents/1.0&quot;,
      &quot;envelopemetadata&quot;: {
        &quot;attributes&quot;: {
          &quot;type&quot;: {
            &quot;value&quot;: &quot;myevent&quot;
          }
        }
      }
    }
  }
}
</code></pre>
<p>When this specification, and the <a href="../message/spec.md">message specification</a>,
are used with specifications such as <a href="https://cloudevents.io">CloudEvents</a>,
where a semantically unique identifier is used in a runtime message (e.g.
CloudEvent's <code>type</code> attribute), it is STRONGLY RECOMMENDED that the
<code>messageid</code> values of the message definitions for an Endpoint match that
unique identifier and therefore be unique across all messages within the
<code>messages</code> collection and the messages referenced by the <code>messagegroups</code>
attribute. This will allow for an easy &quot;lookup&quot; from an incoming runtime
message to its related message definition.</p>
<p>However, there are times when this is not possible. For example, take the case
where an Endpoint might have the same semantic message defined twice, once for
a JSON serialization and once for an XML serialization. Using the same
<code>messageid</code> value is not possible (even though the CloudEvent <code>type</code> attribute
would be the same for both runtime messages), so one (or both) message
definition's <code>messageid</code> values might not match the runtime message's <code>type</code>
value. In those cases, finding the appropriate message definition will need to
be done via examination of some other metadata - such as the message's
<code>envelopemetadata.type</code> value along with its <code>envelopeoptions.format</code> value.
These details are out of scope for this specification to define and are left as
an implementation detail.</p>
<p>Implementations MAY choose to generate an error if it detects duplicate
<code>messageid</code> values across the <code>messages</code> collection message definitions and
the <code>messagegroups</code> referenced message definitions, if that is the desired
constraint for their users.</p>
<h4 id="protocol-options">Protocol Options <a class="anchor" href="#protocol-options">ðŸ”—</a></h4>
<p>The following protocol options (<code>protocoloptions.options</code>) are defined for the
respective protocols. All of these are OPTIONAL.</p>
<h5 id="http-options">HTTP options <a class="anchor" href="#http-options">ðŸ”—</a></h5>
<p>The <a href="#protocoloptionsendpoints">endpoint URIs</a> for &quot;HTTP&quot; endpoints MUST be
valid HTTP URIs using the &quot;http&quot; or &quot;https&quot; scheme.</p>
<p>The following options are defined for HTTP:</p>
<ul>
<li><code>method</code>: The HTTP method to use for the endpoint.
<ul>
<li>When not specified, the default value MUST be <code>POST</code>.</li>
<li>The value MUST be a valid HTTP method name.</li>
</ul>
</li>
<li><code>headers</code>: An array of HTTP headers to use for the endpoint. HTTP allows for
duplicate headers. The objects in the array have the following attributes:
<ul>
<li><code>name</code>: The name of the HTTP header. The value MUST be a non-empty string.</li>
<li><code>value</code>: The value of the HTTP header. The value MUST be a non-empty
string.</li>
</ul>
</li>
<li><code>query</code>: A map of HTTP query parameters to use for the endpoint. The value
MUST be a map of non-empty strings to non-empty strings.</li>
</ul>
<p>The values of all <code>query</code> and <code>headers</code> MAY contain placeholders using the
<a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI Template syntax. When the same placeholder is
used in multiple properties, the value of the placeholder is assumed to be
identical.</p>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;protocol&quot;: &quot;HTTP/1.1&quot;,
  &quot;protocoloptions&quot;: {
    &quot;method&quot;: &quot;POST&quot;,
    &quot;headers&quot;: [
      {
        &quot;name&quot;: &quot;Content-Type&quot;,
        &quot;value&quot;: &quot;application/json&quot;
      }
    ],
    &quot;query&quot;: {
      &quot;operation&quot;: &quot;send&quot;
    }
  }
}
</code></pre>
<h5 id="amqp-options">AMQP options <a class="anchor" href="#amqp-options">ðŸ”—</a></h5>
<p>The <a href="#protocoloptionsendpoints">endpoint URIs</a> for &quot;AMQP&quot; endpoints MUST be
valid AMQP URIs using the &quot;amqp&quot; or &quot;amqps&quot; scheme. If the path portion of the
URI is present, it MUST be a valid AMQP node name.</p>
<p>The following options are defined for AMQP endpoints.</p>
<ul>
<li><code>node</code>: The name of the AMQP node (a queue or topic or some addressable
entity) to use for the endpoint.
<ul>
<li>When specified, the value overrides the path portion of the Endpoint URI.</li>
</ul>
</li>
<li><code>durable</code>: If <code>true</code>, the AMQP <code>durable</code> flag is set on transfers.
<ul>
<li>When not specified, the default value MUST be <code>false</code>.</li>
<li>This option only applies to <code>usage:producer</code> endpoints.</li>
</ul>
</li>
<li><code>linkproperties</code>: A map of AMQP link properties to use for the endpoint.
<ul>
<li>The value MUST be a map of non-empty strings to non-empty strings.</li>
</ul>
</li>
<li><code>connection-properties</code>: A map of AMQP connection properties to use for the
endpoint.
<ul>
<li>The value MUST be a map of non-empty strings to non-empty strings.</li>
</ul>
</li>
<li><code>distributionmode</code>: Either <code>move</code> or <code>copy</code>.
<ul>
<li>When not specified, the default value MUST be <code>move</code>.</li>
<li>The distribution mode is AMQP's way of expressing whether a receiver
operates on copies of messages (it's a topic subscriber) or whether it
moves messages from the queue (it's a queue consumer). This option only
applies to <code>usage:consumer</code> endpoints.</li>
</ul>
</li>
</ul>
<p>The values of all <code>linkproperties</code> and <code>connection-properties</code> MAY contain
placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1 URI Template syntax. When the
same placeholder is used in multiple properties, the value of the placeholder
is assumed to be identical.</p>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;usage&quot;: [ &quot;producer&quot; ],
  &quot;protocol&quot;: &quot;AMQP/1.0&quot;,
  &quot;protocoloptions&quot;: {
    &quot;node&quot;: &quot;myqueue&quot;,
    &quot;durable&quot;: true,
    &quot;linkproperties&quot;: {
      &quot;mylinkproperty&quot;: &quot;mylinkpropertyvalue&quot;
    },
    &quot;connection-properties&quot;: {
      &quot;my-connection-property&quot;: &quot;my-connection-property-value&quot;
    },
    &quot;distributionmode&quot;: &quot;move&quot;
  }
}
</code></pre>
<h5 id="mqtt-options">MQTT options <a class="anchor" href="#mqtt-options">ðŸ”—</a></h5>
<p>The <a href="#protocoloptionsendpoints">endpoint URIs</a> for &quot;MQTT&quot; endpoints MUST be
valid MQTT URIs using the (informal) &quot;mqtt&quot; or &quot;mqtts&quot; scheme. If the path
portion of the URI is present, it MUST be a valid MQTT topic name. The informal
schemes &quot;tcp&quot; (plain TCP/1883), &quot;ssl&quot; (TLS TCP/8883), and &quot;wss&quot;
(Websockets/443) MAY also be used, but MUST NOT have a path.</p>
<p>The following options are defined for MQTT endpoints.</p>
<ul>
<li><code>topic</code>: The MQTT topic to use for the endpoint.
<ul>
<li>When specified, the value overrides the path portion of the Endpoint URI.</li>
<li>The value MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax.</li>
</ul>
</li>
<li><code>qos</code>: The MQTT Quality of Service (QoS) level to use for the endpoint.
<ul>
<li>The value MUST be an integer between 0 and 2.</li>
<li>When not specified, the default value MUST be 0.</li>
<li>The value is overidden by the <code>qos</code> property of the
<a href="../message/spec.md#mqtt311-and-mqtt50-protocols">MQTT message format</a>.</li>
</ul>
</li>
<li><code>retain</code>: If <code>true</code>, the MQTT <code>retain</code> flag is set on transfers.
<ul>
<li>When not specified, the default value is <code>false</code>.</li>
<li>The value is overidden by the <code>retain</code> property of the <a href="../message/spec.md#mqtt311-and-mqtt50-protocols">MQTT
message format</a>. This
option only applies to <code>usage:producer</code> endpoints.</li>
</ul>
</li>
<li><code>cleansession</code>: If <code>true</code>, the MQTT <code>cleansession</code> flag is set on
connections.
<ul>
<li>When not specified, the default value MUST be <code>true</code>.</li>
</ul>
</li>
<li><code>willtopic</code>: The MQTT <code>willtopic</code> to use for the endpoint.
<ul>
<li>The value MUST be a non-empty string.</li>
<li>The value MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax.</li>
</ul>
</li>
<li><code>willmessage</code>: This is an XID that refers to the MQTT <code>willmessage</code> to use for
the endpoint.
<ul>
<li>The value MUST be a non-empty XID.</li>
<li>It MUST point to a valid
<a href="../message/spec.md#message-definitions">Â´messageÂ´</a> that MUST either
use the <a href="../message/spec.md#cloudevents10">&quot;CloudEvents/1.0&quot;</a> or
<a href="../message/spec.md#mqtt311-and-mqtt50-protocols">&quot;MQTT/3.1.1.&quot; or
&quot;MQTT/5.0&quot;</a>
<a href="../message/spec.md#envelope"><code>envelope</code></a>.</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;usage&quot;: [ &quot;producer&quot; ],
  &quot;protocol&quot;: &quot;MQTT/5.0&quot;,
  &quot;protocoloptions&quot;: {
    &quot;topic&quot;: &quot;mytopic&quot;,
    &quot;qos&quot;: 1,
    &quot;retain&quot;: false,
    &quot;cleansession&quot;: false,
    &quot;willtopic&quot;: &quot;mytopic&quot;,
    &quot;willmessage&quot;: &quot;/messagegroups/mygroup/messages/mywillmessage&quot;
  }
}
</code></pre>
<h5 id="kafka-options">KAFKA options <a class="anchor" href="#kafka-options">ðŸ”—</a></h5>
<p>The <a href="#protocoloptionsendpoints">endpoint URIs</a> for &quot;Kafka&quot; endpoints MUST be
valid Kafka bootstrap server addresses. The scheme follows Kafka configuration
usage, e.g. <code>SSL://&lt;HOST&gt;:&lt;PORT&gt;</code> or <code>PLAINTEXT://&lt;HOST&gt;:&lt;PORT&gt;</code>.</p>
<p>The following options are defined for Kafka endpoints.</p>
<ul>
<li><code>topic</code>: The Kafka topic to use for the endpoint.
<ul>
<li>When specified, the value MUST be a non-empty string.</li>
<li>The value MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax.</li>
</ul>
</li>
<li><code>acks</code>: The Kafka <code>acks</code> setting to use for the endpoint.
<ul>
<li>The value MUST be an integer between -1 and 1.</li>
<li>When not specified, the default value MUST be 1.</li>
<li>This option only applies to <code>usage:producer</code> endpoints.</li>
</ul>
</li>
<li><code>key</code>: The fixed Kafka key to use for this endpoint.
<ul>
<li>When specified, the value MUST be a non-empty string.</li>
<li>This option only applies to <code>usage:producer</code> endpoints.</li>
<li>The value MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax.</li>
</ul>
</li>
<li><code>partition</code>: The fixed Kafka partition to use for this endpoint.
<ul>
<li>When specified, the value MUST be an integer.</li>
<li>This option only applies to <code>usage:producer</code> endpoints.</li>
</ul>
</li>
<li><code>consumergroup</code>: The Kafka consumer group to use for this endpoint.
<ul>
<li>When specified, the value MUST be a non-empty string.</li>
<li>This option only applies to <code>usage:consumer</code> endpoints.</li>
<li>The value MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax.</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;usage&quot;: [ &quot;producer&quot; ],
  &quot;protocol&quot;: &quot;Kafka/2.0&quot;,
  &quot;protocoloptions&quot;: {
    &quot;topic&quot;: &quot;mytopic&quot;,
    &quot;acks&quot;: 1,
    &quot;key&quot;: &quot;mykey&quot;,
  }
}
</code></pre>
<h5 id="nats-options">NATS options <a class="anchor" href="#nats-options">ðŸ”—</a></h5>
<p>The <a href="#protocoloptionsendpoints">endpoint URIs</a> for &quot;NATS&quot; endpoints MUST be
valid NATS URIs. The scheme MUST be &quot;nats&quot; or &quot;tls&quot; or &quot;ws&quot; and the URI MUST
include a port number, e.g. <code>nats://&lt;HOST&gt;:&lt;PORT&gt;</code> or <code>tls://&lt;HOST&gt;:&lt;PORT&gt;</code>.</p>
<p>The following options are defined for NATS endpoints.</p>
<ul>
<li><code>subject</code>: The NATS subject to use.
<ul>
<li>The value MAY contain placeholders using the <a href="https://www.rfc-editor.org/rfc/rfc6570">RFC6570</a> Level 1
URI Template syntax.</li>
</ul>
</li>
</ul>
<p>Example:</p>
<pre><code class="language-yaml">{
  &quot;usage&quot;: [ &quot;producer&quot; ],
  &quot;protocol&quot;: &quot;NATS/1.0.0&quot;,
  &quot;protocoloptions&quot;: {
    &quot;subject&quot;: &quot;mysubject&quot;
  }
}
</code></pre>

</html>
